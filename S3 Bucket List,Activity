import boto3
import datetime

s3 = boto3.client('s3')
cloudtrail = boto3.client('cloudtrail')

buckets = s3.list_buckets()['Buckets']

print("S3 Buckets:")
for bucket in buckets:
  name = bucket['Name']
  print(f"- {name}")

  response = cloudtrail.lookup_events(
    LookupAttributes=[
      {
        'AttributeKey': 'ResourceName',
        'AttributeValue': f'arn:aws:s3:::{name}'  
      }
    ]
  )

  try:
    last_event = response['Events'][-1]
    print(f"  Last activity: {last_event['EventTime']}")
  except IndexError:
    print("  No activity found")
